(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const C="/assets/light-0-BoDT8MNN.svg",L="/assets/light-1-CmrVVxEA.svg",O="/assets/light-2-D_6QEExO.svg",k="/assets/light-3-JAWiTxXG.svg",B="/assets/light-4-i_IZe635.svg",D="/assets/dark-0-Bq18aCld.svg",M="/assets/dark-1-B9D11Ll7.svg",N="/assets/dark-2-DZHS0ygR.svg",V="/assets/dark-3-C_ZC34da.svg",R="/assets/dark-4-CmXKV6RE.svg",_="/assets/selected-0-BffIglP9.svg",P="/assets/selected-1-CgyxXTgu.svg",b="/assets/selected-2-CBM0Odc6.svg",$="/assets/selected-3-CC1RL8QL.svg",J="/assets/selected-4-Cy8nkRhA.svg",A=[C,L,O,k,B],U=[D,M,N,V,R],g=[_,P,b,$,J];class W{constructor(e){this.handImages=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?U:A;const t=this.generateGameScreen(e,e.computerHands,e.playerHands);this.gameScreenElements=t}generateGameScreen(e){const t=[document.getElementById("computer-left"),document.getElementById("computer-right")];t.forEach((o,u)=>{o.addEventListener("click",x=>{e.handleSelectHand({type:"computer",index:u})})});const s=[document.getElementById("player-left"),document.getElementById("player-right")];s.forEach((o,u)=>{o.addEventListener("click",x=>{e.handleSelectHand({type:"player",index:u})})});const a=document.getElementById("tap-text"),r=document.querySelector("dialog"),i=document.getElementById("depth-slider"),l=document.getElementById("depth-value");i.addEventListener("change",o=>{e.handleDepthChange(o.target.value)});const h=document.getElementById("speed-slider"),d=document.getElementById("speed-value");h.addEventListener("change",o=>{e.handleSpeedChange(o.target.value)}),document.getElementById("restart").addEventListener("click",o=>e.restartRound()),document.getElementById("reset").addEventListener("click",o=>e.resetRound()),document.getElementById("about").addEventListener("click",o=>{r.showModal()}),document.getElementById("close-dialog").addEventListener("click",o=>{r.close()});const p=document.getElementById("computer-score"),y=document.getElementById("player-score");return{computerElements:t,playerElements:s,tapText:a,depthSlider:i,depthValue:l,speedSlider:h,speedValue:d,computerScore:p,playerScore:y}}refreshHands(e,t){this.gameScreenElements.computerElements.forEach((s,a)=>{e[a].selected?(s.src=g[e[a].value],s.classList="selected"):(s.src=this.handImages[e[a].value],s.classList="")}),this.gameScreenElements.playerElements.forEach((s,a)=>{t[a].selected?(s.src=g[t[a].value],s.classList="selected"):(s.src=this.handImages[t[a].value],s.classList="")})}}const H=new Map;for(let n of[1,2,3,4])for(let e of[1,2,3,4])H.set(`[${n}]x[${e}]`,X(n,e));function X(n,e){let t=new Set,s=!1,a=1;for(;!s;){if(t.has(`${n}x${e}`))return 0;if(t.add(`${n}x${e}`),a===1){if(e=(e+n)%5,e===0)return a}else if(n=(n+e)%5,n===0)return a;a*=-1}}function I(n,e,t,s,a,r){let i=t,l=r.get(v(n))||{};if(Object.keys(l).length>0&&l.depth>=e&&(l.flag==="EXACT"||(l.flag==="LOWERBOUND"?t=Math.max(t,l.value):l==="UPPERBOUND"&&(s=Math.min(s,l.value)),t>=s)))return l.value;if(e===0||G(n))return q(n,a);const h=K(n,a);let d=-1/0;for(let c of h)if(d=Math.max(d,-I(c,e-1,-s,-t,-a,r)),t=Math.max(t,d),t>=s)break;return l.value=d,d<=i?l.flag="UPPERBOUND":d>=s?l.flag="LOWERBOUND":l.flag="EXACT",l.depth=e,r.set(v(n),l),d}function v(n){return`${JSON.stringify(n[0].sort())}x${JSON.stringify(n[1].sort())}`}function G(n){return n[0].length===0||n[1].length===0}function q(n,e){const t=n[e===1?0:1],s=n[e===1?1:0];if(t.length===0)return-1;if(s.length===0)return 1;if(t.length===2&&s.length===2)return f(t,s)?.5:0;if(t.length===2&&s.length===1)return f(t,s)?1:.5;if(t.length===1&&s.length===2)return f(t,s)?0:-.5;if(t.length===1&&s.length===1)return H.get(`${JSON.stringify(t)}x${JSON.stringify(s)}`)}function f(n,e){return n.some(t=>{e.some(s=>{})})}function K(n,e){const t=[],s=n[e===1?0:1],a=n[e===1?1:0];return s.forEach(r=>{for(let i=0;i<a.length;i++){let l=a.slice();l[i]=(l[i]+r)%5,l[i]===0&&l.splice(i,1),t.push(e===1?[s,l]:[l,s])}}),t}const E={computer:[1,1],player:[1,1]};function Z(n){let e={};for(let[t,s]of n)e[t]=s;return e}function Q(n){let e=new Map;for(let t of Object.keys(n))e.set(t,n[t]);return e}class Y{constructor(e,t,s,a,r,i){this.computerHands=e,this.playerHands=t,this.score=s,this.display=new W(this),this.transpositionTable=a,this.depth=r,this.delay=i}handleSelectHand(e){if(this.isValid(e)){const t=e.index;switch(e.type){case"computer":this.handleRound(t);break;case"player":this.playerHands.forEach((s,a)=>{a===t?s.selected=!s.selected:s.selected=!1}),this.updateDisplay();break}}}isValid(e){switch(e.type){case"computer":return this.playerHands.find(t=>t.selected===!0)&&this.computerHands[e.index].value!=0;case"player":return this.playerHands[e.index].value!=0}}async handleRound(e){this.selectHand("computer",e);let t=this.getTapValue(this.playerHands);if(await this.showTapText("player",t),await this.updateHandValue(this.computerHands,e,t),this.clearHandSelect(),this.clearTapText(),this.updateDisplay(),this.winCheck())await this.handleWin("player");else{const s=await this.chooseMove();this.selectHand("computer",s.sourceIndex),t=s.sourceValue,await this.showTapText("computer",t),await this.selectHand("player",s.targetIndex,this.delay),await this.updateHandValue(this.playerHands,s.targetIndex,t),this.clearHandSelect(),this.clearTapText(),this.updateDisplay(),this.winCheck()&&await this.handleWin("computer"),this.saveData()}}async selectHand(e,t,s=0){return e==="computer"?this.computerHands[t].selected=!0:this.playerHands[t].selected=!0,this.updateDisplay(),new Promise(a=>{setTimeout(()=>{a()},s)})}getTapValue(e){let t=e.findIndex(s=>s.selected===!0);return e[t].value}showTapText(e,t){return this.display.gameScreenElements.tapText.textContent=`${e==="player"?"You tap":"The computer taps"} for ${t}`,new Promise(s=>{setTimeout(()=>{s()},this.delay)})}async updateHandValue(e,t,s){return e[t].value=(e[t].value+s)%5,this.updateDisplay(),new Promise(a=>{setTimeout(()=>{a()},this.delay)})}clearHandSelect(){for(let e of this.playerHands)e.selected=!1;for(let e of this.computerHands)e.selected=!1}clearTapText(){this.display.gameScreenElements.tapText.textContent=""}winCheck(){return this.computerHands.every(e=>e.value===0)||this.playerHands.every(e=>e.value===0)}async handleWin(e){await new Promise(t=>{this.display.gameScreenElements.tapText.textContent=`${e==="computer"?"The computer has":" You have"} won!`,this.score[e]++,this.updateScore(),setTimeout(()=>{this.clearTapText(),this.restartRound(),t()},1.5*this.delay)})}chooseMove(){return new Promise(e=>{setTimeout(()=>{let t,s=-1/0,a=this.computerHands.map(c=>c.value).filter(c=>c!=0),r=this.playerHands.map(c=>c.value).filter(c=>c!=0);a.forEach((c,T,w)=>{r.forEach((m,p,y)=>{let o=y.slice();o[p]=(m+c)%5,o[p]===0&&o.splice(p,1);let u=-I([o,a.slice()],this.depth,-1/0,1/0,1,this.transpositionTable);u>s&&(s=u,t={sourceValue:c,targetValue:m})})});let i=t.sourceValue,l=this.computerHands.findIndex(c=>c.value===i),h=t.targetValue,d=this.playerHands.findIndex(c=>c.value===h);e({sourceValue:i,sourceIndex:l,targetValue:h,targetIndex:d})},1.5*this.delay)})}updateDisplay(){this.display.refreshHands(this.computerHands,this.playerHands),this.updateScore()}handleDepthChange(e){this.depth=e}handleSpeedChange(e){this.delay=(10-e)*200}restartRound(){this.computerHands.forEach((e,t)=>e.value=E.computer[t]),this.playerHands.forEach((e,t)=>e.value=E.player[t]),this.clearHandSelect(),this.updateDisplay()}resetRound(){this.score.computer=0,this.score.player=0,this.updateScore(),this.clearTapText(),this.restartRound(),sessionStorage.clear()}updateScore(){this.display.gameScreenElements.computerScore.textContent=this.score.computer,this.display.gameScreenElements.playerScore.textContent=this.score.player}saveData(){let e={computerHands:this.computerHands,playerHands:this.playerHands,score:this.score,transpositionTable:JSON.stringify(Z(this.transpositionTable)),depth:this.depth,delay:this.delay};sessionStorage.setItem("gameData",JSON.stringify(e)),sessionStorage.setItem("hasLoaded",!0)}handleRefreshContent(e){this.computerHands=e.computerHands,this.playerHands=e.playerHands,this.score=e.score,this.transpositionTable=Q(JSON.parse(e.transpositionTable)),this.depth=e.depth,this.delay=e.delay,this.updateScore(),this.updateDisplay(),this.display.gameScreenElements.depthSlider.value=this.depth,this.display.gameScreenElements.depthValue.value=this.depth,this.display.gameScreenElements.speedSlider.value=10-this.delay/200,this.display.gameScreenElements.speedValue.textContent=10-this.delay/200}}const F=sessionStorage.getItem("hasLoaded")||!1,S=new Y([{value:1,selected:!1},{value:1,selected:!1}],[{value:1,selected:!1},{value:1,selected:!1}],{computer:0,player:0},new Map,5,1e3);F?S.handleRefreshContent(JSON.parse(sessionStorage.getItem("gameData"))):S.updateDisplay();
