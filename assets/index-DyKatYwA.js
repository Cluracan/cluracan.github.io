(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const T="/assets/light-0-BoDT8MNN.svg",O="/assets/light-1-CmrVVxEA.svg",B="/assets/light-2-D_6QEExO.svg",C="/assets/light-3-ZZ6xtcpZ.svg",$="/assets/light-4-Bvf1SIdr.svg",L="/assets/dark-0-Bq18aCld.svg",k="/assets/dark-1-B9D11Ll7.svg",D="/assets/dark-2-DZHS0ygR.svg",N="/assets/dark-3-C_ZC34da.svg",M="/assets/dark-4-CmXKV6RE.svg",_="/assets/selected-0-BffIglP9.svg",R="/assets/selected-1-CgyxXTgu.svg",P="/assets/selected-2-CBM0Odc6.svg",V="/assets/selected-3-CC1RL8QL.svg",J="/assets/selected-4-Cy8nkRhA.svg",b=[T,O,B,C,$],U=[L,k,D,N,M],E=[_,R,P,V,J];class W{constructor(e){this.handImages=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?U:b;const t=this.generateGameScreen(e,e.computerHands,e.playerHands);this.gameScreenElements=t,this.refreshHands(e.computerHands,e.playerHands)}generateGameScreen(e){const t=[document.getElementById("computer-left"),document.getElementById("computer-right")];t.forEach((o,h)=>{o.addEventListener("click",x=>{e.handleSelectHand({type:"computer",index:h})})});const s=[document.getElementById("player-left"),document.getElementById("player-right")];s.forEach((o,h)=>{o.addEventListener("click",x=>{e.handleSelectHand({type:"player",index:h})})});const a=document.getElementById("tap-text"),r=document.querySelector("dialog"),c=document.getElementById("depth-slider");c.addEventListener("change",o=>e.handleDepthChange(o.target.value));const l=document.getElementById("depth-value"),u=document.getElementById("speed-slider");u.addEventListener("change",o=>e.handleSpeedChange(o.target.value));const d=document.getElementById("depth-value");document.getElementById("restart").addEventListener("click",o=>e.restartRound()),document.getElementById("reset").addEventListener("click",o=>e.resetRound()),document.getElementById("about").addEventListener("click",o=>{r.showModal()}),document.getElementById("close-dialog").addEventListener("click",o=>{r.close()});const p=document.getElementById("computer-score"),f=document.getElementById("player-score");return{computerElements:t,playerElements:s,tapText:a,depthSlider:c,depthValue:l,speedSlider:u,speedValue:d,computerScore:p,playerScore:f}}refreshHands(e,t){this.gameScreenElements.computerElements.forEach((s,a)=>{e[a].selected?(s.src=E[e[a].value],s.classList="selected"):(s.src=this.handImages[e[a].value],s.classList="")}),this.gameScreenElements.playerElements.forEach((s,a)=>{t[a].selected?(s.src=E[t[a].value],s.classList="selected"):(s.src=this.handImages[t[a].value],s.classList="")})}}const I=new Map;for(let n of[1,2,3,4])for(let e of[1,2,3,4])I.set(`[${n}]x[${e}]`,Z(n,e));function Z(n,e){let t=new Set,s=!1,a=1;for(;!s;){if(t.has(`${n}x${e}`))return 0;if(t.add(`${n}x${e}`),a===1){if(e=(e+n)%5,e===0)return a}else if(n=(n+e)%5,n===0)return a;a*=-1}}function w(n,e,t,s,a,r){let c=t,l=r.get(H(n))||{};if(Object.keys(l).length>0&&l.depth>=e&&(l.flag==="EXACT"||(l.flag==="LOWERBOUND"?t=Math.max(t,l.value):l==="UPPERBOUND"&&(s=Math.min(s,l.value)),t>=s)))return l.value;if(e===0||A(n))return X(n,a);const u=q(n,a);let d=-1/0;for(let i of u)if(d=Math.max(d,-w(i,e-1,-s,-t,-a,r)),t=Math.max(t,d),t>=s)break;return l.value=d,d<=c?l.flag="UPPERBOUND":d>=s?l.flag="LOWERBOUND":l.flag="EXACT",l.depth=e,r.set(H(n),l),d}function H(n){return`${JSON.stringify(n[0].sort())}x${JSON.stringify(n[1].sort())}`}function A(n){return n[0].length===0||n[1].length===0}function X(n,e){const t=n[e===1?0:1],s=n[e===1?1:0];if(t.length===0)return-1;if(s.length===0)return 1;if(t.length===2&&s.length===2)return m(t,s)?.5:0;if(t.length===2&&s.length===1)return m(t,s)?1:.5;if(t.length===1&&s.length===2)return m(t,s)?0:-.5;if(t.length===1&&s.length===1)return I.get(`${JSON.stringify(t)}x${JSON.stringify(s)}`)}function m(n,e){return n.some(t=>{e.some(s=>{})})}function q(n,e){const t=[],s=n[e===1?0:1],a=n[e===1?1:0];return s.forEach(r=>{for(let c=0;c<a.length;c++){let l=a.slice();l[c]=(l[c]+r)%5,l[c]===0&&l.splice(c,1),t.push(e===1?[s,l]:[l,s])}}),t}const S={computer:[1,1],player:[1,1]},G=1e3;class K{constructor(e,t,s,a,r){this.computerHands=e,this.playerHands=t,this.score=s,this.display=new W(this),this.transpositionTable=a,this.depth=r,this.delay=G}handleSelectHand(e){if(this.isValid(e)){const t=e.index;switch(e.type){case"computer":this.handleRound(t);break;case"player":this.playerHands.forEach((s,a)=>{a===t?s.selected=!s.selected:s.selected=!1}),this.updateDisplay();break}}}isValid(e){switch(e.type){case"computer":return this.playerHands.find(t=>t.selected===!0)&&this.computerHands[e.index].value!=0;case"player":return this.playerHands[e.index].value!=0}}async handleRound(e){this.selectHand("computer",e);let t=this.getTapValue(this.playerHands);if(await this.showTapText("player",t),await this.updateHandValue(this.computerHands,e,t),this.clearHandSelect(),this.clearTapText(),this.updateDisplay(),this.winCheck())this.handleWin("player");else{const s=await this.chooseMove();this.selectHand("computer",s.sourceIndex),t=s.sourceValue,await this.showTapText("computer",t),await this.selectHand("player",s.targetIndex,this.delay),await this.updateHandValue(this.playerHands,s.targetIndex,t),this.clearHandSelect(),this.clearTapText(),this.updateDisplay(),this.winCheck()&&this.handleWin("computer")}}async selectHand(e,t,s=0){return e==="computer"?this.computerHands[t].selected=!0:this.playerHands[t].selected=!0,this.updateDisplay(),new Promise(a=>{setTimeout(()=>{a()},s)})}getTapValue(e){console.log(e);let t=e.findIndex(s=>s.selected===!0);return e[t].value}showTapText(e,t){return this.display.gameScreenElements.tapText.textContent=`${e==="player"?"You tap":"The computer taps"} for ${t}`,new Promise(s=>{setTimeout(()=>{s()},this.delay)})}async updateHandValue(e,t,s){return e[t].value=(e[t].value+s)%5,this.updateDisplay(),new Promise(a=>{setTimeout(()=>{a()},this.delay)})}clearHandSelect(){for(let e of this.playerHands)e.selected=!1;for(let e of this.computerHands)e.selected=!1}clearTapText(){this.display.gameScreenElements.tapText.textContent=""}winCheck(){return this.computerHands.every(e=>e.value===0)||this.playerHands.every(e=>e.value===0)}async handleWin(e){await new Promise(t=>{this.display.gameScreenElements.tapText.textContent=`${e==="computer"?"The computer has":" You have"} won!`,this.score[e]++,this.updateScore(),setTimeout(()=>{this.clearTapText(),this.restartRound(),t()},1.5*this.delay)})}chooseMove(){return new Promise(e=>{setTimeout(()=>{let t,s=-1/0,a=this.computerHands.map(i=>i.value).filter(i=>i!=0),r=this.playerHands.map(i=>i.value).filter(i=>i!=0);console.log(`computer filters ${JSON.stringify(this.computerHands)} into ${JSON.stringify(a)}`),a.forEach(i=>{console.log(`here: ${i}`)}),a.forEach((i,y,v)=>{console.log(`trying ${i} ${y} ${JSON.stringify(v)}`),r.forEach((g,p,f)=>{let o=f.slice();o[p]=(g+i)%5,o[p]===0&&o.splice(p,1),console.log(`tapping ${i} on ${JSON.stringify(f)} to get ${JSON.stringify(o)}`);let h=-w([o,a.slice()],this.depth,-1/0,1/0,1,this.transpositionTable);console.log(`scores ${h}`),h>s&&(s=h,t={sourceValue:i,targetValue:g})})}),console.log(a),console.log(`best move is ${JSON.stringify(t)}`);let c=t.sourceValue,l=this.computerHands.findIndex(i=>i.value===c),u=t.targetValue,d=this.playerHands.findIndex(i=>i.value===u);e({sourceValue:c,sourceIndex:l,targetValue:u,targetIndex:d})},1.5*this.delay)})}updateDisplay(){this.display.refreshHands(this.computerHands,this.playerHands)}handleDepthChange(e){this.depth=e}handleSpeedChange(e){this.delay=(10-e)*200}restartRound(){this.computerHands.forEach((e,t)=>e.value=S.computer[t]),this.playerHands.forEach((e,t)=>e.value=S.player[t]),this.clearHandSelect(),this.updateDisplay()}resetRound(){this.score.computer=0,this.score.player=0,this.updateScore(),this.clearTapText(),this.restartRound()}updateScore(){this.display.gameScreenElements.computerScore.textContent=this.score.computer,this.display.gameScreenElements.playerScore.textContent=this.score.player}}const Q=new Map;new K([{value:1,selected:!1},{value:1,selected:!1}],[{value:1,selected:!1},{value:1,selected:!1}],{computer:0,player:0},Q,10);
